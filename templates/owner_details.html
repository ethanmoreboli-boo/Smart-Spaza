{% extends "base.html" %}

{% block title %}SmartSpaza - Owner Details{% endblock %}

{% block head %}
<style>
body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', sans-serif;
    position: relative;
    background: url('/static/line.webp') no-repeat center center fixed;
    background-size: cover;
}

/* Overlay layer for brightness control */
body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.3); /* adjust opacity for brightness */
    pointer-events: none;        /* ensures overlay doesn‚Äôt block clicks */
    z-index: -1;                 /* keeps it behind all content */
}



@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Hero Section */
.hero {
    background: linear-gradient(90deg, #503dff, #71c575);
    color: white;
    padding: 40px 20px;
    text-align: center;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.hero img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
    border: 3px solid white;
}
.hero h1 {
    font-size: 28px;
    margin: 10px 0;
}
.hero p {
    font-size: 16px;
    margin: 4px 0;
}

/* Navigation */
.nav-bar-top {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 16px;
    padding: 14px 20px;
    margin: 20px auto;
}
.nav-bar-top a {
    text-decoration: none;
    color: #4CAF50;
    font-weight: 600;
    padding: 10px 18px;
    border-radius: 8px;
    transition: all 0.3s ease;
    background-color: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.nav-bar-top a:hover {
    background-color: #4CAF50;
    color: white;
}


.profile-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;              
    max-width: 1000px;
    margin: 20px auto;     
    padding: 15px;        
}
.profile-card, .stats-grid {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    padding: 18px;
}
.profile-card h2 {
    color: #2e7d32;
    margin-bottom: 10px;
}
.profile-card p {
    margin: 6px 0;
    color: #555;
}
.edit-btn {
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
.edit-btn:hover { background-color: #388e3c; }

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;              
}
.stats-grid .stat {
    background: #f9f9f9;
    padding: 12px;          
    border-radius: 10px;
    text-align: center;
    transition: transform 0.3s ease;
}
.stats-grid .stat:hover { transform: translateY(-4px); }
.stats-grid h4 { color: #666; margin-bottom: 8px; }
.stats-grid p { font-size: 18px; font-weight: bold; color: #2e7d32; }

/* Activity Timeline */
.timeline {
    max-width: 1000px;
    margin: 20px auto;      /* reduced from 30px */
    background: #fff;
    padding: 18px;          /* reduced from 20px */
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}
.timeline h3 { margin-bottom: 10px; } /* reduced from 15px */
.timeline li { margin: 6px 0; padding: 8px; } /* reduced spacing */

/* Back Button */
.back {
    display: block;
    text-align: center;
    margin: 20px auto;      /* reduced from 30px */
    padding: 8px 18px;      /* slightly reduced */
    text-decoration: none;
    color: #007bff;
    border: 2px solid #007bff;
    border-radius: 8px;
    transition: all 0.3s ease;
    width: 180px;           /* slightly narrower */
}
.back:hover { background-color: #007bff; color: white; }

/* Responsive */
@media (max-width: 768px) {
    .profile-section { grid-template-columns: 1fr; }
    .hero img { width: 90px; height: 90px; }
}

.hero-content {
  display: flex;
  align-items: center;
  gap: 20px;
  justify-content: center;
}
.hero-avatar img {
  width: 170px;
  height: 110px;
  border-radius: 0;
  object-fit: cover;
  border: 3px solid white;
}
.hero-info h1 {
  margin: 0;
  font-size: 28px;
  color: #fff;
}
.hero-info p {
  margin: 4px 0;
  color: #f0f0f0;
}

</style>
{% endblock %}

{% block content %}
<div class="hero">
  <div class="hero-content">
    <div class="hero-avatar">
      <img src="{{ owner.avatar_url or '/static/default-avatar.png' }}" alt="Profile Image">
    </div>
    <div class="hero-info">
      <strong><p class="shop-name" style="font-size: 65px;"> {{ owner.shop_name }}</p></strong>
    </div>
  </div>
</div>

<div class="nav-bar-top">
    <a href="{{ url_for('dashboard') }}"> ‚¨ÖDashboard</a>
    <a href="{{ url_for('progress') }}"> Progress</a>
    <a href="{{ url_for('report_default') }}"> Report</a>
    <a href="{{ url_for('add_product') }}"> Add Product</a>
</div>

<div class="profile-section">
    <div class="profile-card">
        <h2>Owner Info</h2>
        <p><strong>Username:</strong> {{ owner.username }}</p>
        <p><strong>Email:</strong> {{ owner.email }}</p>
        <p><strong>Location:</strong> {{ owner.location }}</p>
        <p><strong>Contact:</strong> {{ owner.cellnumber }}</p>
        <button class="edit-btn" onclick="document.getElementById('editModal').style.display='block'">‚úèÔ∏è Edit Profile</button>
    </div>

    <div class="stats-grid">
        <div class="stat">
            <h4>Total Products</h4>
            <p>{{ owner.product_count }}</p>
        </div>
        <div class="stat">
            <h4>Total Sales</h4>
            <p>R{{ "%.2f"|format(owner.total_sales) }}</p>
        </div>
        <div class="stat">
            <h4>Total Profit</h4>
            <p>R{{ "%.2f"|format(owner.total_profit|float) }}</p>
        </div>

    </div>
</div>

<div class="timeline">
    <h3>Recent Activity</h3>
    <ul>
        {% for product in owner.products %}
        <li>üõí {{ product['name'] }} ‚Äî Sales: R{{ "%.2f"|format(product['total_sales'] or 0) }}</li>
        {% endfor %}
    </ul>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="document.getElementById('editModal').style.display='none'">&times;</span>
    <h2>Edit Profile</h2>
    <form method="POST" action="{{ url_for('update_owner') }}" enctype="multipart/form-data">
      <label for="avatar">Profile Image</label>
      <input type="file" name="avatar" id="avatar" accept="image/*">

      <label for="shop_name">Shop Name</label>
      <input type="text" name="shop_name" id="shop_name" value="{{ owner.shop_name }}" required>

      <label for="email">Email</label>
      <input type="email" name="email" id="email" value="{{ owner.email }}" required>

      <button type="submit">üíæ Save Changes</button>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
window.addEventListener('DOMContentLoaded', () => {
  const toasts = document.querySelectorAll('#toast-container .toast-message');
  toasts.forEach(toast => {
    toast.style.opacity = 1;
    toast.style.transform = "translateY(-10px)";
    setTimeout(() => {
      toast.style.opacity = 0;
      toast.style.transform = "translateY(0)";
    }, 3000);
  });
});
</script>
{% endblock %}
